schema: '2.0'
stages:
  _check-env-tex:
    cmd: calkit check environment --name tex
    outs:
    - path: .calkit/env-locks/tex.json
      hash: md5
      md5: c25288f842fbbf08b32381c979e0e12e
      size: 1171
  sync-overleaf:
    cmd: bash --noprofile --norc -c "calkit overleaf sync --no-commit --no-push"
  build-paper:
    cmd: calkit xenv -n tex --no-check -- latexmk -cd -interaction=nonstopmode -f
      -pdf paper/main.tex
    deps:
    - path: .calkit/env-locks/tex.json
      hash: md5
      md5: c25288f842fbbf08b32381c979e0e12e
      size: 1171
    - path: paper/aasjournal.bst
      hash: md5
      md5: 1e2d4614828005814bd64e3c665b8e99
      size: 36130
    - path: paper/aastex631.cls
      hash: md5
      md5: 3a8503ea2dc529eec05658a2b11d12d0
      size: 231673
    - path: paper/figures/workflow.pdf
      hash: md5
      md5: bbdeb3fea7b0d744ffba650a0d0c40db
      size: 7722175
    - path: paper/main.tex
      hash: md5
      md5: 971fde2bf3c95df0e3ba235b0031a40e
      size: 47949
    - path: paper/references.bib
      hash: md5
      md5: e28caf9f2df60abd3a7046f962edbbc3
      size: 1032229
    - path: paper/results.tex
      hash: md5
      md5: 6c9ee986430bc3e128b786305cee0c3a
      size: 186
    outs:
    - path: paper/main.pdf
      hash: md5
      md5: a1e266f3700300e22a96506fe5a3e11e
      size: 7986281
  run-benchmarks:
    cmd: bash --noprofile --norc scripts/run-benchmarks.sh
    deps:
    - path: boom/Cargo.lock
      hash: md5
      md5: 9bfc469a3d04968b453874c8c2ada965
      size: 126660
    - path: boom/src
      hash: md5
      md5: 500a1fa9e0f050c1f7c52eede63dd758.dir
      size: 252247
      nfiles: 37
    - path: scripts/run-benchmarks.sh
      hash: md5
      md5: 1c645c1912c220a6f1f1b07e0d2241dc
      size: 369
    outs:
    - path: paper/results.tex
      hash: md5
      md5: c13e23589a77173ddec14e1c43937a53
      size: 188
  _check-env-boom:
    cmd: calkit check environment --name boom
    deps:
    - path: Dockerfile-boom
      hash: md5
      md5: c3ae93706b5217df6b70af7a5a819bd2
      size: 1150
    outs:
    - path: .calkit/env-locks/boom.json
      hash: md5
      md5: fb1633d7248b37100660db4799fa9ccf
      size: 1355
  benchmark-boom:
    cmd: bash --noprofile --norc scripts/benchmark-boom.sh
    deps:
    - path: Dockerfile-boom
      hash: md5
      md5: c3ae93706b5217df6b70af7a5a819bd2
      size: 1150
    - path: boom/Cargo.lock
      hash: md5
      md5: 9bfc469a3d04968b453874c8c2ada965
      size: 126660
    - path: boom/Cargo.toml
      hash: md5
      md5: 8e8daf6d3bec0efbad62c78c6ca7eeef
      size: 1489
    - path: boom/src
      hash: md5
      md5: 500a1fa9e0f050c1f7c52eede63dd758.dir
      size: 252247
      nfiles: 37
    - path: config/boom/compose.yaml
      hash: md5
      md5: 4c3a3edd351f4a3277c071e135d18f66
      size: 4494
    - path: config/boom/config-consumer.yaml
      hash: md5
      md5: e84e781c5978506b93283e865bf039ec
      size: 1823
    - path: config/boom/config.yaml
      hash: md5
      md5: b752fb658677c78ccdfb44bda085910d
      size: 1816
    - path: data/kowalski.NED.json.gz
      hash: md5
      md5: decd3ed39729067d0990aa299c4f513d
      size: 966995306
    - path: scripts/benchmark-boom.sh
      hash: md5
      md5: 7ea1fb5e3ee2c87a7650ce5a83ff05e1
      size: 1352
      isexec: true
    - path: scripts/mongo-import-ned.sh
      hash: md5
      md5: d7c69cd7975e24a541cc778da272be24
      size: 290
      isexec: true
    outs:
    - path: logs/boom
      hash: md5
      md5: 8356361527ace830710d2f55ee67799e.dir
      size: 1723784
      nfiles: 5
  make-kowalski-version-file:
    cmd: bash --noprofile --norc -c "echo benchmarking > kowalski/version.txt"
  _check-env-analyze-logs:
    cmd: calkit check environment --name analyze-logs
    deps:
    - path: config/envs/analyze-logs.txt
      hash: md5
      md5: 8dbb896d89b7bbae0bd44a3db397e6fb
      size: 47
    outs:
    - path: .calkit/env-locks/analyze-logs.txt
      hash: md5
      md5: bc1acb39f7277a5c19e3b693a7a8a2a4
      size: 2097
  make-kowalski-mongo-key-file:
    cmd: bash --noprofile --norc -c "echo thisisarandomkeyfortesting > kowalski/mongo_key.yaml"
  benchmark-kowalski:
    cmd: bash --noprofile --norc scripts/benchmark-kowalski.sh
    deps:
    - path: config/kowalski/compose.yaml
      hash: md5
      md5: 75e5331e97a5ee29ee6b28af1b8fb7a2
      size: 3798
    - path: config/kowalski/config.yaml
      hash: md5
      md5: 4aca796f28a0aa662f6dc5aac96cc312
      size: 37314
    - path: config/kowalski/supervisord.conf
      hash: md5
      md5: e4551a531a506d3f4bcfa429239f4f41
      size: 1119
    - path: data/kowalski.NED.json.gz
      hash: md5
      md5: decd3ed39729067d0990aa299c4f513d
      size: 966995306
    - path: kowalski/Makefile
      hash: md5
      md5: acd8ea2eccdc60f398008d3108ae25d8
      size: 3728
    - path: kowalski/ingester.Dockerfile
      hash: md5
      md5: 9e13312ab68b655f4d0907c8cd26b90d
      size: 4637
    - path: kowalski/kowalski
      hash: md5
      md5: 67a94df680d77e3d03cae4d82046f3cd.dir
      size: 931133
      nfiles: 81
    - path: scripts/benchmark-kowalski.sh
      hash: md5
      md5: e1cab22d9f6f3a32fd10e8a22e4ae965
      size: 1236
      isexec: true
    - path: scripts/mongo-import-ned.sh
      hash: md5
      md5: d7c69cd7975e24a541cc778da272be24
      size: 290
      isexec: true
    outs:
    - path: logs/kowalski
      hash: md5
      md5: 11570a0c3e89fa766c9f1961279c58a4.dir
      size: 53701143
      nfiles: 4
  _clean-nb-analyze-logs:
    cmd: calkit nb clean "notebooks/analyze-logs.ipynb"
    deps:
    - path: notebooks/analyze-logs.ipynb
      hash: md5
      md5: 923168cdd5473bf5f9275157dad2ad99
      size: 3505
    outs:
    - path: .calkit/notebooks/cleaned/notebooks/analyze-logs.ipynb
      hash: md5
      md5: 923168cdd5473bf5f9275157dad2ad99
      size: 3505
  analyze-logs:
    cmd: calkit nb execute --environment analyze-logs --no-check --to html "notebooks/analyze-logs.ipynb"
    deps:
    - path: .calkit/env-locks/analyze-logs.txt
      hash: md5
      md5: bc1acb39f7277a5c19e3b693a7a8a2a4
      size: 2097
    - path: .calkit/notebooks/cleaned/notebooks/analyze-logs.ipynb
      hash: md5
      md5: 923168cdd5473bf5f9275157dad2ad99
      size: 3505
    - path: logs/boom
      hash: md5
      md5: 8356361527ace830710d2f55ee67799e.dir
      size: 1723784
      nfiles: 5
    - path: logs/kowalski
      hash: md5
      md5: 11570a0c3e89fa766c9f1961279c58a4.dir
      size: 53701143
      nfiles: 4
    outs:
    - path: .calkit/notebooks/executed/notebooks/analyze-logs.ipynb
      hash: md5
      md5: ea0696bbd2fde42b460b012ace999930
      size: 4589
    - path: .calkit/notebooks/html/notebooks/analyze-logs.html
      hash: md5
      md5: 92103135dec985d477b6bd0b4e9f0722
      size: 280133
    - path: paper/results.tex
      hash: md5
      md5: 6c9ee986430bc3e128b786305cee0c3a
      size: 186
