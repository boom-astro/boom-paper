stages:
  _check-env-tex:
    cmd: calkit check environment --name tex
    deps: []
    outs:
      - .calkit/env-locks/tex.json:
          cache: false
          persist: true
    always_changed: true
    desc: Automatically generated by Calkit. Changes made here will be overwritten.
  _check-env-boom:
    cmd: calkit check environment --name boom
    deps:
      - Dockerfile-boom
    outs:
      - .calkit/env-locks/boom.json:
          cache: false
          persist: true
    always_changed: true
    desc: Automatically generated by Calkit. Changes made here will be overwritten.
  _check-env-analyze-logs:
    cmd: calkit check environment --name analyze-logs
    deps:
      - config/envs/analyze-logs.txt
    outs:
      - .calkit/env-locks/analyze-logs.txt:
          cache: false
          persist: true
    always_changed: true
    desc: Automatically generated by Calkit. Changes made here will be overwritten.
  make-kowalski-version-file:
    cmd: bash --noprofile --norc -c "echo benchmarking > kowalski/version.txt"
    deps: []
    outs: []
    always_changed: true
    desc: Automatically generated from the 'make-kowalski-version-file'
      stage in calkit.yaml. Changes made here will be overwritten.
  make-kowalski-mongo-key-file:
    cmd: bash --noprofile --norc -c "echo thisisarandomkeyfortesting > kowalski/mongo_key.yaml"
    deps: []
    outs: []
    always_changed: true
    desc: Automatically generated from the 'make-kowalski-mongo-key-file'
      stage in calkit.yaml. Changes made here will be overwritten.
  benchmark-boom:
    cmd: bash --noprofile --norc scripts/benchmark-boom.sh
    deps:
      - scripts/benchmark-boom.sh
      - boom/src
      - boom/Cargo.lock
      - boom/Cargo.toml
      - config/boom/config.yaml
      - config/boom/compose.yaml
      - config/boom/config-consumer.yaml
      - .calkit/env-locks/boom.json
    outs:
      - logs/boom/producer.log
      - logs/boom/consumer.log
      - logs/boom/scheduler.log
    desc: Automatically generated from the 'benchmark-boom' stage in calkit.yaml.
      Changes made here will be overwritten.
  benchmark-kowalski:
    cmd: bash --noprofile --norc scripts/benchmark-kowalski.sh
    deps:
      - scripts/benchmark-kowalski.sh
      - config/kowalski/config.yaml
      - config/kowalski/compose.yaml
      - config/kowalski/supervisord.conf
      - kowalski/ingester.Dockerfile
      - kowalski/kowalski
      - kowalski/Makefile
    outs:
      - logs/kowalski
    desc: Automatically generated from the 'benchmark-kowalski' stage in
      calkit.yaml. Changes made here will be overwritten.
  _clean-nb-analyze-logs:
    cmd: calkit nb clean "notebooks/analyze-logs.ipynb"
    deps:
      - notebooks/analyze-logs.ipynb
    outs:
      - .calkit/notebooks/cleaned/notebooks/analyze-logs.ipynb:
          cache: false
    desc: Automatically generated from the 'analyze-logs' stage in calkit.yaml.
      Changes made here will be overwritten.
  analyze-logs:
    cmd: calkit nb execute --environment analyze-logs --no-check --to html
      "notebooks/analyze-logs.ipynb"
    deps:
      - .calkit/notebooks/cleaned/notebooks/analyze-logs.ipynb
      - .calkit/env-locks/analyze-logs.txt
      - logs/boom/producer.log
      - logs/boom/consumer.log
      - logs/boom/scheduler.log
      - logs/kowalski
    outs:
      - paper/results.tex:
          cache: false
          persist: false
      - .calkit/notebooks/executed/notebooks/analyze-logs.ipynb:
          cache: false
      - .calkit/notebooks/html/notebooks/analyze-logs.html:
          cache: false
    desc: Automatically generated from the 'analyze-logs' stage in calkit.yaml.
      Changes made here will be overwritten.
  build-paper:
    cmd: calkit xenv -n tex --no-check -- latexmk -cd -interaction=nonstopmode
      -f -pdf paper/main.tex
    deps:
      - paper/main.tex
      - paper/references.bib
      - paper/figures/workflow.pdf
      - paper/aasjournal.bst
      - paper/aastex631.cls
      - paper/results.tex
      - .calkit/env-locks/tex.json
    outs:
      - paper/main.pdf
    desc: Automatically generated from the 'build-paper' stage in calkit.yaml.
      Changes made here will be overwritten.
