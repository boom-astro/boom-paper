stages:
  _check-env-tex:
    cmd: calkit check environment --name tex
    deps: []
    outs:
      - .calkit/env-locks/tex.json:
          cache: false
          persist: true
    always_changed: true
    desc: Automatically generated by Calkit. Changes made here will be
      overwritten.
  _check-env-analyze-logs:
    cmd: calkit check environment --name analyze-logs
    deps:
      - config/envs/analyze-logs.txt
    outs:
      - .calkit/env-locks/analyze-logs.txt:
          cache: false
          persist: true
    always_changed: true
    desc: Automatically generated by Calkit. Changes made here will be
      overwritten.
  _check-env-run:
    cmd: calkit check environment --name run
    deps:
      - config/envs/run.txt
    outs:
      - .calkit/env-locks/run.txt:
          cache: false
          persist: true
    always_changed: true
    desc: Automatically generated by Calkit. Changes made here will be
      overwritten.
  benchmark-boom:
    cmd: calkit xenv -n run --no-check -- python 
      scripts/benchmark-boom.py 
      --n-alert-workers=${item.n_alert_workers} 
      --n-ml-workers=${item.n_ml_workers} 
      --n-filter-workers=${item.n_filter_workers}
    deps:
      - scripts/benchmark-boom.py
      - boom/src
      - boom/Cargo.lock
      - boom/Cargo.toml
      - scripts/benchmark-boom.sh
      - config/boom/config-template.yaml
      - config/boom/compose.yaml
      - Dockerfile-boom
      - scripts/mongo-import-ned.sh
      - data/kowalski.NED.json.gz
      - .calkit/env-locks/run.txt
    outs:
      - logs/boom-na=${item.n_alert_workers}-nml=${item.n_ml_workers}-nf=${item.n_filter_workers}
    matrix:
      n_alert_workers:
        - 1
        - 3
      n_ml_workers:
        - 3
        - 6
        - 9
      n_filter_workers:
        - 1
        - 3
    desc: Automatically generated from the 'benchmark-boom' stage in 
      calkit.yaml. Changes made here will be overwritten.
  benchmark-kowalski:
    cmd: calkit xenv -n run --no-check -- python 
      scripts/benchmark-kowalski.py --n-workers=${item.n_workers}
    deps:
      - scripts/benchmark-kowalski.py
      - config/kowalski/config-template.yaml
      - config/kowalski/compose.yaml
      - config/kowalski/supervisord.conf
      - kowalski/ingester.Dockerfile
      - kowalski/kowalski
      - kowalski/Makefile
      - kowalski/requirements
      - scripts/mongo-import-ned.sh
      - scripts/benchmark-kowalski.sh
      - data/kowalski.NED.json.gz
      - .calkit/env-locks/run.txt
    outs:
      - logs/kowalski-n=${item.n_workers}
    matrix:
      n_workers:
        - 3
        - 6
        - 7
        - 9
    desc: Automatically generated from the 'benchmark-kowalski' stage 
      in calkit.yaml. Changes made here will be overwritten.
  _clean-nb-analyze-logs:
    cmd: calkit nb clean "notebooks/analyze-logs.ipynb"
    deps:
      - notebooks/analyze-logs.ipynb
    outs:
      - .calkit/notebooks/cleaned/notebooks/analyze-logs.ipynb:
          cache: false
    desc: Automatically generated from the 'analyze-logs' stage in 
      calkit.yaml. Changes made here will be overwritten.
  analyze-logs:
    cmd: calkit nb execute --environment analyze-logs --no-check --to 
      html "notebooks/analyze-logs.ipynb"
    deps:
      - .calkit/notebooks/cleaned/notebooks/analyze-logs.ipynb
      - .calkit/env-locks/analyze-logs.txt
      - logs/boom-na=1-nml=3-nf=1
      - logs/boom-na=1-nml=3-nf=3
      - logs/boom-na=1-nml=6-nf=1
      - logs/boom-na=1-nml=6-nf=3
      - logs/boom-na=1-nml=9-nf=1
      - logs/boom-na=1-nml=9-nf=3
      - logs/boom-na=3-nml=3-nf=1
      - logs/boom-na=3-nml=3-nf=3
      - logs/boom-na=3-nml=6-nf=1
      - logs/boom-na=3-nml=6-nf=3
      - logs/boom-na=3-nml=9-nf=1
      - logs/boom-na=3-nml=9-nf=3
      - logs/kowalski-n=3
      - logs/kowalski-n=6
      - logs/kowalski-n=7
      - logs/kowalski-n=9
    outs:
      - paper/results.tex:
          cache: false
          persist: false
      - results:
          cache: false
          persist: false
      - .calkit/notebooks/executed/notebooks/analyze-logs.ipynb:
          cache: false
      - .calkit/notebooks/html/notebooks/analyze-logs.html:
          cache: false
    desc: Automatically generated from the 'analyze-logs' stage in 
      calkit.yaml. Changes made here will be overwritten.
  build-paper:
    cmd: calkit xenv -n tex --no-check -- latexmk -cd 
      -interaction=nonstopmode -silent -f -synctex=1 -pdf 
      paper/main.tex
    deps:
      - paper/main.tex
      - paper/references.bib
      - paper/figures/workflow.pdf
      - paper/aasjournal.bst
      - paper/aastex631.cls
      - paper/results.tex
      - .calkit/env-locks/tex.json
    outs:
      - paper/main.pdf
    desc: Automatically generated from the 'build-paper' stage in 
      calkit.yaml. Changes made here will be overwritten.
